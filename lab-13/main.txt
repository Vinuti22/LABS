<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ö–Ω–∏–≥ (JS Collections)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        .add-btn { background-color: #5cb85c; color: white; }
        .add-btn:hover { background-color: #4cae4c; }
        .search-btn { background-color: #007bff; color: white; }
        .search-btn:hover { background-color: #0056b3; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        #book-list { list-style: none; padding: 0; }
        #book-list li { background: #e9ecef; margin-bottom: 10px; padding: 15px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background-color: #dc3545; color: white; margin-left: 10px; }
        .delete-btn:hover { background-color: #c82333; }
        .sort-btn { background-color: #ffc107; color: #333; }
        .sort-btn:hover { background-color: #e0a800; }
        .book-details { flex-grow: 1; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìö –ú–µ–Ω–µ–¥–∂–µ—Ä –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ö–Ω–∏–≥</h1>
        
        <section>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –ö–Ω–∏–≥—É</h2>
            <div class="form-group"><label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label><input type="text" id="title" required></div>
            <div class="form-group"><label for="author">–ê–≤—Ç–æ—Ä:</label><input type="text" id="author" required></div>
            <div class="form-group"><label for="year">–ì–æ–¥:</label><input type="number" id="year" required></div>
            <div class="form-group"><label for="isbn">ISBN (–£–Ω–∏–∫–∞–ª—å–Ω—ã–π):</label><input type="text" id="isbn" required></div>
            <button class="add-btn" onclick="addBookHandler()">–î–æ–±–∞–≤–∏—Ç—å –≤ –ö–æ–ª–ª–µ–∫—Ü–∏—é</button>
        </section>

        <hr>

        <section>
            <h2>–ü–æ–∏—Å–∫ –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
            <div class="controls">
                <input type="text" id="search-query" placeholder="–ò—Å–∫–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É..." style="flex-grow: 1;">
                <button class="search-btn" onclick="searchBooksHandler()">–ù–∞–π—Ç–∏</button>
                <button class="sort-btn" onclick="sortBooks('title')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ù–∞–∑–≤–∞–Ω–∏—é</button>
                <button class="sort-btn" onclick="sortBooks('year')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ì–æ–¥—É</button>
            </div>
        </section>

        <hr>

        <section>
            <h2>–¢–µ–∫—É—â–∞—è –ö–æ–ª–ª–µ–∫—Ü–∏—è</h2>
            <ul id="book-list">
                </ul>
        </section>
    </div>

    <script>
        // --- 1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ö–æ–ª–ª–µ–∫—Ü–∏–∏ ---
        let books = []; // –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: Array (–ú–∞—Å—Å–∏–≤)
        let bookMap = new Map(); // –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞: Map (–∫–ª—é—á=id, –∑–Ω–∞—á–µ–Ω–∏–µ=–æ–±—ä–µ–∫—Ç –∫–Ω–∏–≥–∏)
        let isbnSet = new Set(); // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏: Set (—Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ ISBN)

        // --- 2. –§—É–Ω–∫—Ü–∏–∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –î–∞–Ω–Ω—ã–º–∏ ---

        /** –î–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–∏–≥—É –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (Array, Map, Set). */
        function addBook(title, author, year, isbn) {
            if (isbnSet.has(isbn)) {
                alert(`–û—à–∏–±–∫–∞: –ö–Ω–∏–≥–∞ —Å ISBN ${isbn} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.`);
                return false;
            }

            const newBook = {
                id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                title: title,
                author: author,
                year: Number(year),
                isbn: isbn
            };

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Array
            books.push(newBook);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Map (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –ø–æ ID O(1))
            bookMap.set(newBook.id, newBook);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Set (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ O(1))
            isbnSet.add(isbn);
            
            return true;
        }

        /** –£–¥–∞–ª—è–µ—Ç –∫–Ω–∏–≥—É –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø–æ ID. */
        function deleteBook(id) {
            // –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –∏–∑ Map –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è ISBN
            const bookToDelete = bookMap.get(id);
            if (!bookToDelete) return; 

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Array (–ò—Å–ø–æ–ª—å–∑—É–µ–º filter)
            books = books.filter(book => book.id !== id);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Map (–ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ O(1))
            bookMap.delete(id);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Set (–ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ O(1))
            isbnSet.delete(bookToDelete.isbn);
            
            displayBooks(books); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        }

        /** –ò—â–µ—Ç –∫–Ω–∏–≥–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É). */
        function searchBooks(query) {
            const lowerQuery = query.toLowerCase();
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Array.filter() –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–∫—Å—Ç—É (O(N))
            return books.filter(book => 
                book.title.toLowerCase().includes(lowerQuery) ||
                book.author.toLowerCase().includes(lowerQuery)
            );
        }

        /** –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞—Å—Å–∏–≤ –∫–Ω–∏–≥. */
        function sortBooks(key) {
            books.sort((a, b) => {
                if (key === 'title') {
                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫ (–ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É)
                    return a.title.localeCompare(b.title);
                } else if (key === 'year') {
                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∏—Å–µ–ª (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)
                    return a.year - b.year;
                }
                return 0;
            });
            displayBooks(books); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        }

        // --- 3. –§—É–Ω–∫—Ü–∏–∏ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (DOM) ---

        /** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–∞–¥–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ –∫–Ω–∏–≥ –Ω–∞ —ç–∫—Ä–∞–Ω–µ. */
        function displayBooks(bookArray) {
            const listElement = document.getElementById('book-list');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Array.map() –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HTML
            const htmlList = bookArray.map(book => `
                <li>
                    <div class="book-details">
                        <strong>${book.title}</strong> (${book.year})<br>
                        <em>–ê–≤—Ç–æ—Ä: ${book.author}</em> | ISBN: ${book.isbn}
                    </div>
                    <button class="delete-btn" onclick="deleteBook(${book.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </li>
            `).join(''); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Array.join('') –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM

            listElement.innerHTML = htmlList;
        }

        // --- 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –°–æ–±—ã—Ç–∏–π ---

        function addBookHandler() {
            const title = document.getElementById('title').value.trim();
            const author = document.getElementById('author').value.trim();
            const year = document.getElementById('year').value.trim();
            const isbn = document.getElementById('isbn').value.trim();

            if (!title || !author || !year || !isbn) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
                return;
            }

            if (addBook(title, author, year, isbn)) {
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
                document.getElementById('title').value = '';
                document.getElementById('author').value = '';
                document.getElementById('year').value = '';
                document.getElementById('isbn').value = '';
                
                displayBooks(books); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            }
        }

        function searchBooksHandler() {
            const query = document.getElementById('search-query').value.trim();
            const results = searchBooks(query);
            displayBooks(results); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            
            if (results.length === 0) {
                alert('–ö–Ω–∏–≥–∏ –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ–π)
        window.onload = () => {
            // –î–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–∏–≥ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
            addBook('1984', '–î–∂–æ—Ä–¥–∂ –û—Ä—É—ç–ª–ª', 1949, '978-5-17-080344-9');
            addBook('–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', '–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤', 1967, '978-5-17-081044-7');
            addBook('–ì–æ—Ä–¥–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—É–±–µ–∂–¥–µ–Ω–∏–µ', '–î–∂–µ–π–Ω –û—Å—Ç–∏–Ω', 1813, '978-5-17-080944-0');
            
            displayBooks(books);
        };
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function sortBooksHandler(key) {
            sortBooks(key);
        }
    </script>

</body>
</html>
